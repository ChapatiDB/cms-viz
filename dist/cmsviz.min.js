!function(){var a,b,c,d,e,f,g,h,i,j,k;b=[120,150],a=25,c={chrg:{size:[400,220],display:"Average Charge",value_fmt:d3.format("$,.0f"),geo_path:null,svg:null,regions:null,centered:null,delay:250,leg_svg:null},pmt:{size:[400,220],display:"Average Payment",value_fmt:d3.format("$,.0f"),geo_path:null,svg:null,regions:null,centered:null,delay:250,leg_svg:null},reduct:{size:[600,330],display:"Reduction",value_fmt:function(a){return d3.format(".0f")(a)+"%"},geo_path:null,svg:null,regions:null,centered:null,delay:0,leg_svg:null}},k=function(a){d3.map(c).forEach(function(b,c){var d,e,f,g,h,i,j,k,l,m;return i=c.svg,k=c.size[0],f=c.size[1],e=c.geo_path,null!=a&&c.centered!==a?(d=e.centroid(a),l=d[0],m=d[1],g=4,c.centered=a):(l=k/2,m=f/2,g=1,c.centered=null),i.selectAll("g").selectAll("path").classed("active",c.centered&&function(a){var b,d;return c.centered?a===c.centered?!0:(null!=(b=a.properties)?b.HRRNUM:void 0)===(null!=(d=c.centered.properties)?d.HRRNUM:void 0)?!0:!1:!1}),h=i.selectAll("g").selectAll("path"),j=h.transition().duration(750).attr("transform","translate("+k/2+","+f/2+")scale("+g+")translate("+-l+","+-m+")").attr("stroke-width",1/g+"px").delay(c.delay)})},g=function(a,b){queue().defer(d3.json,"data/procs/"+a+"_"+b+"_hrr.json").await(function(a,b){return a&&alert("Sorry, an error has occurred"),j("chrg",b),j("pmt",b),j("reduct",b)})},i=function(a,b){var d,e,f,g,h;for(f=c[a].leg_svg,f.selectAll("text").remove(),d=h=5;h>=0;d=h+=-1)0===d?g="No data":(e=c[a].value_fmt(b[d-1]),g=">= "+e),f.append("text").attr("x",30).attr("y",25*(Math.abs(d-5)+1)-8).text(g)},j=function(a,b){var d,e,f,g,h;e=d3.entries(b),f=c[a].regions,h=e.map(function(b){return Math.ceil(+b.value[a])+1}),d=ss.jenks(h,4),d.unshift(0),g=d3.scale.threshold().domain(d).range(d3.range(6).map(function(a){return"q"+(a-1)+"-5"})),i(a,d),f.attr("class",function(c){var d;return null!=(null!=(d=c.properties)?d.HRRNUM:void 0)&&null!=b[c.properties.HRRNUM]?g(b[c.properties.HRRNUM][a]):"empty"}),f.selectAll("title").text(function(d){var e,f,g,h;return null!=(null!=d?d.properties:void 0)?(g="HRR for "+d.properties.HRRCITY,h=c[a].value_fmt,e=c[a].display,null!=b[d.properties.HRRNUM]&&(f=h(b[d.properties.HRRNUM][a]),g+="\n"+e+": "+f),g):null}),null!=c[a].centered&&d3.map(c).forEach(function(a,b){return b.svg.selectAll("g").selectAll("path").classed("active",function(a){var c,d;return(null!=(c=a.properties)?c.HRRNUM:void 0)===(null!=(d=b.centered.properties)?d.HRRNUM:void 0)?!0:!1})})},d=function(a,b){var d,e,f,g,h,i,j;return j=c[a].size[0],e=c[a].size[1],f=d3.geo.albersUsa().scale(j+100).translate([j/2,e/2]),c[a].geo_path=d3.geo.path().projection(f),d=c[a].geo_path,i=c[a].svg,g=topojson.feature(b,b.objects.HRR_Bdry).features,h=i.append("g").attr("class","region hrr_"+a).selectAll("path").data(g).enter().append("path").attr("d",d).on("click",k),h.append("title").text(function(a){return null!=(null!=a?a.properties:void 0)?"HRR for "+a.properties.HRRCITY:null}),i.append("g").append("path").datum(topojson.mesh(b,b.objects.HRR_Bdry)).attr("d",d).attr("class","region_bdry"),h},f=function(a,b){var d,e,f;return f=c[a].size[0],d=c[a].size[1],e=d3.select(b).append("svg").style("width",f).style("height",d)},e=function(a){var c,d,e,f,g,h;for(g=b[0],d=b[1],f=d3.select(a).append("svg").style("width",g).style("height",d),e=h=0;5>=h;e=++h)c=5===e?"empty":"q"+Math.abs(e-5+1)+"-5",f.append("rect").attr("x",0).attr("y",25*e).attr("width",25).attr("height",25).attr("class",c);return f},h=function(a,b){var h,i,j,k,l,m;c.chrg.svg=f("chrg","#chrg_map"),c.pmt.svg=f("pmt","#pmt_map"),c.reduct.svg=f("reduct","#reduct_map"),c.chrg.leg_svg=e("#chrgLegend"),c.pmt.leg_svg=e("#pmtLegend"),c.reduct.leg_svg=e("#reductLegend"),c.chrg.regions=d("chrg",b),c.pmt.regions=d("pmt",b),c.reduct.regions=d("reduct",b),l=d3.select("#selectDrg"),m=d3.select("#selectDrgGroup"),j=d3.select("#selectApc"),k=d3.select("#selectApcGroup"),h=d3.select("#inpatientBtn"),i=d3.select("#outpatientBtn"),l.on("change",function(){var a;a=this.options[this.selectedIndex].value,g("drg",a)}),j.on("change",function(){var a;a=this.options[this.selectedIndex].value,g("apc",a)}),h.on("click",function(){return h.classed("pure-button-active")?void 0:(i.classed("pure-button-active",!1),h.classed("pure-button-active",!0),m.classed("hidden",!1),k.classed("hidden",!0),l.node().selectedIndex=0,g("drg",l.node().options[0].value))}),i.on("click",function(){return i.classed("pure-button-active")?void 0:(h.classed("pure-button-active",!1),i.classed("pure-button-active",!0),k.classed("hidden",!1),m.classed("hidden",!0),j.node().selectedIndex=0,g("apc",j.node().options[0].value))}),g("drg",l.node().options[0].value)},queue().defer(d3.json,"data/hrr_sp007.topojson").await(h)}.call(this);