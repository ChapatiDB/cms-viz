!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;b=[120,150],a=25,c={chrg:{size:[400,220],display:"Average Charge",value_fmt:d3.format("$,.0f"),geo_path:null,svg:null,regions:null,centered:null,delay:350,leg_svg:null},pmt:{size:[400,220],display:"Average Payment",value_fmt:d3.format("$,.0f"),geo_path:null,svg:null,regions:null,centered:null,delay:350,leg_svg:null},reduct:{size:[600,330],display:"Reduction",value_fmt:function(a){return d3.format(".1f")(a)+"%"},geo_path:null,svg:null,regions:null,centered:null,delay:0,leg_svg:null}},h=null,n=function(a){d3.map(c).forEach(function(b,c){var d,e,f,g,h,i,j,k,l,m;return i=c.svg,k=c.size[0],f=c.size[1],e=c.geo_path,null!=a&&c.centered!==a?(d=e.centroid(a),l=d[0],m=d[1],g=4,c.centered=a):(l=k/2,m=f/2,g=1,c.centered=null),i.selectAll("g").selectAll("path").classed("active",c.centered&&function(a){var b,d;return c.centered?a===c.centered?!0:(null!=(b=a.properties)?b.HRRNUM:void 0)===(null!=(d=c.centered.properties)?d.HRRNUM:void 0)?!0:!1:!1}),h=i.selectAll("g").selectAll("path"),j=h.transition().duration(750).attr("transform","translate("+k/2+","+f/2+")scale("+g+")translate("+-l+","+-m+")").attr("stroke-width",1/g+"px").delay(c.delay)})},m=function(a){var b,d;return null==a.properties||null==h?(d3.select("#over_name").classed("hidden",!0),void 0):(d3.select("#over_name").text(a.properties.HRRCITY),d3.select("#over_name").classed("hidden",!1),b=a.properties.HRRNUM,d=h[b],null==d?(d3.select("#no_data").classed("hidden",!1),d3.select(".has_data").classed("hidden",!0),void 0):(d3.select("#no_data").classed("hidden",!0),d3.select(".has_data").classed("hidden",!1),d3.select("#over_chrg").text(c.chrg.value_fmt(d.chrg)),d3.select("#over_pmt").text(c.pmt.value_fmt(d.pmt)),d3.select("#over_reduct").text(c.reduct.value_fmt(d.reduct)),void 0))},d=function(){d3.select("#over_name").classed("hidden",!0),d3.select("#no_data").classed("hidden",!0),d3.select(".has_data").classed("hidden",!0)},i=function(a,b){queue().defer(d3.json,"data/procs/"+a+"_"+b+"_hrr.json").await(function(a,b){return a&&alert("Sorry, an error has occurred"),h=b,l("chrg",b),l("pmt",b),l("reduct",b)})},k=function(a,b){var d,e,f,g,h;for(f=c[a].leg_svg,f.selectAll("text").remove(),d=h=5;h>=0;d=h+=-1)0===d?g="No data":(e=c[a].value_fmt(b[d-1]),g=">= "+e),f.append("text").attr("x",30).attr("y",25*(Math.abs(d-5)+1)-8).text(g)},l=function(a,b){var d,e,f,g,h;e=d3.entries(b),f=c[a].regions,h=e.map(function(b){return Math.ceil(+b.value[a])+1}),d=ss.jenks(h,4),d.unshift(0),d=d.map(function(a){return Math.ceil(a)}),g=d3.scale.threshold().domain(d).range(d3.range(6).map(function(a){return"q"+(a-1)+"-5"})),k(a,d),f.attr("class",function(c){var d;return null!=(null!=(d=c.properties)?d.HRRNUM:void 0)&&null!=b[c.properties.HRRNUM]?g(b[c.properties.HRRNUM][a]):"empty"}),null!=c[a].centered&&d3.map(c).forEach(function(a,b){return b.svg.selectAll("g").selectAll("path").classed("active",function(a){var c,d;return(null!=(c=a.properties)?c.HRRNUM:void 0)===(null!=(d=b.centered.properties)?d.HRRNUM:void 0)?!0:!1})})},e=function(a,b){var e,f,g,h,i,j,k;return k=c[a].size[0],f=c[a].size[1],g=d3.geo.albersUsa().scale(k+100).translate([k/2,f/2]),c[a].geo_path=d3.geo.path().projection(g),e=c[a].geo_path,j=c[a].svg,h=topojson.feature(b,b.objects.HRR_Bdry).features,i=j.append("g").attr("class","region hrr_"+a).selectAll("path").data(h).enter().append("path").attr("d",e).on("click",n).on("mouseenter",m).on("mouseleave",d),j.append("g").append("path").datum(topojson.mesh(b,b.objects.HRR_Bdry)).attr("d",e).attr("class","region_bdry"),i},g=function(a,b){var d,e,f;return f=c[a].size[0],d=c[a].size[1],e=d3.select(b).append("svg").attr("width",f).attr("height",d)},f=function(a){var c,d,e,f,g,h;for(g=b[0],d=b[1],f=d3.select(a).append("svg").attr("width",g).attr("height",d),e=h=0;5>=h;e=++h)c=5===e?"empty":"q"+Math.abs(e-5+1)+"-5",f.append("rect").attr("x",0).attr("y",25*e).attr("width",25).attr("height",25).attr("class",c);return f},j=function(a,b){var d,h,j,k,l,m;c.chrg.svg=g("chrg","#chrg_map"),c.pmt.svg=g("pmt","#pmt_map"),c.reduct.svg=g("reduct","#reduct_map"),c.chrg.leg_svg=f("#chrgLegend"),c.pmt.leg_svg=f("#pmtLegend"),c.reduct.leg_svg=f("#reductLegend"),c.chrg.regions=e("chrg",b),c.pmt.regions=e("pmt",b),c.reduct.regions=e("reduct",b),l=d3.select("#selectDrg"),m=d3.select("#selectDrgGroup"),j=d3.select("#selectApc"),k=d3.select("#selectApcGroup"),d=d3.select("#inpatientBtn"),h=d3.select("#outpatientBtn"),l.on("change",function(){var a;a=this.options[this.selectedIndex].value,i("drg",a)}),j.on("change",function(){var a;a=this.options[this.selectedIndex].value,i("apc",a)}),d.on("click",function(){return d.classed("pure-button-active")?void 0:(h.classed("pure-button-active",!1),d.classed("pure-button-active",!0),m.classed("hidden",!1),k.classed("hidden",!0),l.node().selectedIndex=0,i("drg",l.node().options[0].value))}),h.on("click",function(){return h.classed("pure-button-active")?void 0:(d.classed("pure-button-active",!1),h.classed("pure-button-active",!0),k.classed("hidden",!1),m.classed("hidden",!0),j.node().selectedIndex=0,i("apc",j.node().options[0].value))}),i("drg",l.node().options[0].value)},queue().defer(d3.json,"data/hrr_sp007.topojson").await(j)}.call(this);